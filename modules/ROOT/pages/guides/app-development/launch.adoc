= Launching a blockchain application
Mona Bärenfänger <mona@lightcurve.io>
:description: How to launch a blockchain application together with the components, seed nodes, genesis block, config objects, & also adding additional nodes.
:toc:
:imagesdir: ../../../assets/images
:v_sdk: 5.1.4
:v_protocol: master
:sectnums:
:experimental:
:idseparator: -
:idprefix:
// URLs
:url_github: https://github.com/
:url_github_corbifex: https://github.com/corbifex/lisk-genesis
:url_github_hello_index: https://github.com/LiskHQ/lisk-sdk-examples/blob/development/hello_world/index.js
:url_github_hello_client: https://github.com/LiskHQ/lisk-sdk-examples/tree/development/hello_world/react-client
:url_github_hello_package: https://github.com/LiskHQ/lisk-sdk-examples/blob/development/hello_world/package.json
:url_github_hello_transaction: https://github.com/LiskHQ/lisk-sdk-examples/tree/development/hello_world/transactions
:url_github_sdk_configDevnet: https://github.com/LiskHQ/lisk-sdk/blob/{v_sdk}/sdk/src/samples/config_devnet.json
:url_gitlab: https://about.gitlab.com/
:url_lisk_community: https://lisk.io/community
// Project URLs
:url_bapps_network: introduction/blockchain-applications.adoc#architecture-of-blockchain-applications
:url_commander_commands_createaccount: references/lisk-commander/commands.adoc#create-account
:url_references_cli_createaccount: references/application-cli.html#accountcreate
:url_guides_forging: guides/node-management/forging.adoc
:url_guides_forging_register: guides/node-management/forging.adoc#registering-a-delegate
:url_guides_forging_enable: guides/node-management/forging.adoc
:url_reference_config: references/config.adoc

== Introduction

How to turn your local 1-node Devnet into an actual blockchain network.

This guide describes how to distribute a blockchain application by establishing a decentralized network of nodes and validators who together are maintaining and securing the blockchain application.

== Initial state: Devnet

During development it is both necessary and convenient to have a rather centralized network with only one node connected.

Once the development has reached a proof of concept or a usable product stage, it will be necessary to add more nodes to the network, and hence offer other potential users the opportunity to join the newly created blockchain network.

This is how the setup looks during development:

image:guides/launch/devnet-node.png[One node diagram]

== Prepare the Testnet

The next step is to create a <<genesis_block, genesis block>> and one <<seed_node, seed node>> and to add one API node to the network that communicates with the seed node:

image:guides/launch/testnet-node.png[Two nodes diagram]

As shown in the diagram above, the plan is to connect a second node with public API which has forging disabled.

With this type of setup, the client application communicates through the HTTP API with the new node.
The seed node communicates simultaneously with the new node via WebSockets.
This in turn ensures that the seed node is informed by the API node, each time a new transaction is sent to the network.

TIP: Using this architecture it is convenient to test if the WebSocket connection between the seed node and the new node is established.

[[genesis_block]]
=== Create a new genesis block

[CAUTION]
====
The exposed `genesisBlockDevnet` and `configDevnet` should only be used during development in a local Devnet, as all the credentials of the Devnet genesis delegates and genesis account are public.

Therefore it is required to generate a **new genesis block** for the blockchain application.
This new genesis block should create new genesis accounts, and the created passphrases need to be kept private in order to ensure that the genesis accounts cannot be hijacked.
====

//TODO: add steps how to create thee genesis block, refer to genesis block guide

[[seed_node]]
=== Define seed nodes

When setting up a new node, each new node will initially connect to the seed nodes when booting for the first time.
Starting from the seed node, a new node will discover the rest of the network by requesting their peer list. This is then followed by the peer lists of the newly discovered peers and so on.

To define a node as a seed node, simply add it to the config as described in section <<config,create a configuration object>>.

==== Seed node config

It is convenient to have the genesis delegates actively forging on the seed node, in case the network does not yet have enough real delegates who can take the forging spots.

CAUTION: It is recommended to keep the config of the seed nodes to yourself, especially if it contains the `defaultpassword` to decrypt the passphrases of the genesis delegates.

Include the data of the new genesis delegates in the config(see xref:{url_guides_forging}[enable forging]), that were created in the <<genesis_block, genesis block>>.

//TODO: Please see the xref:{}[Best practices: seed nodes] section for further recommendations how to configure a seed node.

[[config]]
=== Create a configuration object

Exchange the {url_github_sdk_configDevnet}[configDevnet^] object that was passed to the node during the development with the customized version.

[TIP]

====
It is recommended to create a config object with all the options that differ from the default config options.
To check the default config options, go to the xref:{url_reference_config}[configuration page] or check it directly in the code.
Default options for modules: +
`framework/src/modules/MODULE_NAME/defaults/config.js`. +
Default options for components: +
`framework/src/components/COMPONENT_NAME/defaults/config.js`.
====

Most of the configurations can remain the same as those already defined in the default config options.
However, please note that there is one option that should be updated: **The seed node(s)**.

For example to add `1.2.3.4:5000` as a seed node, add an object with the 2 properties `ip` and `wsPort` to the `seedPeers` list as displayed below:

[source,js]
----
const myConfig = {
     modules: {
         network: {
             seedPeers: [{ ip: '1.2.3.4', wsPort: 5000}]
         }
     }
 };

const app = new Application(genesisBlockDevnet, myConfig);
----

[NOTE]
====
By default, the `forging.delegates` list in the config should be empty.
The user who will later deploy the node on a server can then add the credentials to the config, to xref:{url_guides_forging}[enable forging] for a particular delegate on this node.
====

=== Publish source code

Add the code for the customized `node` application (including the custom transactions), to a public code repository.
For example, on  {url_github}[Github^] or {url_gitlab}[Gitlab^].

This provides all users with the opportunity to download the application, and deploy it on a server in order to connect with the network.

The minimum amount of files required for a node application can be seen listed below:

* {url_github_hello_index}[index.js^] :  The code that initializes and starts the node application.
* {url_github_hello_package}[package.json^]: A project file that lists all needed dependencies, (this should include `lisk-sdk` as a dependency).
* {url_github_hello_transaction}[transactions^]: A folder containing all required custom transactions.
* `README` : A Readme file which describes the most important steps to setup the node.

The client application should be distributed in a separate project, and may contain any desired structure as required.

[[more_nodes]]
== Become validator for the Testnet

During development of the blockchain application, one node was enabled for forging for all 103 genesis delegates.

After the release of the first version of the blockchain application, it is necessary that real, independent delegate accounts take the forging slots of the genesis delegates.

NOTE: The network will become decentralized for the first time when at least 52 individual delegates are actively forging in the network.

.Forging nodes join the network
image:guides/launch/testnet-delegate-nodes.png[3 nodes diagram]

To join the network as a new delegate, follow the steps listed below:

. Create an own, private account on the network.
.. xref:{url_references_cli_createaccount}[Generate the account credentials]
.. Send some funds, (which must be an adequate amount in order to register as a delegate) to the newly generated address.
. xref:{url_guides_forging_register}[Register a delegate].
. Set up a <<node_app,node>>: Follow the steps in the `README` file or docs of the app.
Normally it involves downloading the application code from a public source, connfiguring it (via config or flags on startup), and starting the application.
. xref:{url_guides_forging}[Enable forging] for the newly registered delegate.
. Perform self-vote
. Optional: Convince other accounts to vote for the delegate, to increase the delegate vote weight.

.How to replace a genesis delegate
[NOTE]
====
If a delegate joins the network at a very early stage, it is likely they will probably replace one of the genesis delegates.
The genesis delegates are voted in by the genesis account which holds all the tokens on the initial network start.
The genesis account votes with these tokens for the genesis delegates, in order to stabilize the network during the development.

Therefore, when replacing a genesis delegate, the new delegate will need to convince the person who controls the genesis account of the network; which will most likely be the app developer.
Later, when the majority of the existing tokens are distributed amongst the different private accounts, the new delegate needs to gain the trust of the community in order to be voted into a forging position.
====
