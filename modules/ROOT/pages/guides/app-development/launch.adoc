= Launching a blockchain application
Mona Bärenfänger <mona@lightcurve.io>
:description: How to launch a blockchain application together with the components, seed nodes, genesis block, config objects, & also adding additional nodes.
:toc:
:imagesdir: ../../../assets/images
:v_sdk: 5.1.4
:v_protocol: master
:sectnums:
:experimental:
:idseparator: -
:idprefix:
// URLs
:url_github: https://github.com/
:url_github_corbifex: https://github.com/corbifex/lisk-genesis
:url_github_hello_index: https://github.com/LiskHQ/lisk-sdk-examples/blob/development/hello_world/index.js
:url_github_hello_client: https://github.com/LiskHQ/lisk-sdk-examples/tree/development/hello_world/react-client
:url_github_hello_package: https://github.com/LiskHQ/lisk-sdk-examples/blob/development/hello_world/package.json
:url_github_hello_transaction: https://github.com/LiskHQ/lisk-sdk-examples/tree/development/hello_world/transactions
:url_github_sdk_configDevnet: https://github.com/LiskHQ/lisk-sdk/blob/{v_sdk}/sdk/src/samples/config_devnet.json
:url_gitlab: https://about.gitlab.com/
:url_lisk_community: https://lisk.io/community
// Project URLs
:url_bapps_network: introduction/blockchain-applications.adoc#architecture-of-blockchain-applications
:url_bapps_frontend: introduction/blockchain-applications.adoc#frontend-backend
:url_commander_commands_createaccount: references/lisk-commander/commands.adoc#create-account
:url_references_cli_createaccount: references/application-cli.html#accountcreate
:url_guides_forging: guides/node-management/forging.adoc
:url_guides_setup: guides/app-development/setup.adoc
:url_guides_forging_register: guides/node-management/forging.adoc#registering-a-delegate
:url_guides_forging_enable: guides/node-management/forging.adoc
:url_guides_genesisblock: guides/app-development/genesis-block.adoc
:url_guides_genesisblock_enableforging: guides/app-development/genesis-block.adoc#enabling-forging-for-the-new-genesis-delegates
:url_reference_config: references/config.adoc
:url_references_cli_genesis: references/application-cli.adoc#genesis-blockcreate

== Introduction

How to turn your local 1-node Devnet into an actual blockchain network.

This guide describes how to release a blockchain application to the public and how to establisha decentralized network of nodes and validators who together are maintaining and securing the blockchain application.

////
[NOTE]
====
This guide describes only the most important steps for releasing a basic blockchain application with one connected frontend for a public Testnet.

Additional steps might be required for more complex blockchain applications (e.g. releasing additional software like Middllewares beetween frontend and blockchain application).
See xref:{url_bapps_frontend}[Blockchain applications: Frontend & Backend]
====
////

== Initial state: Devnet

The Devnet is used as default network to connect to during the development of a blockchainn application.
Starting the node after xref:{url_guides_setup}[Bootstrappinng the blockchain application] will always connect to a local Devnet.

During development it is both necessary and convenient to have a rather centralized network with only one node connected.

Once the development has reached a certain maturity, it will be necessary to add more nodes to the network, and hence offer other potential users the opportunity to join the newly created blockchain network.

This is how the setup looks during development:

image:guides/launch/devnet-node.png[One node diagram]

== Prepare the Testnet

To turn the Devnet into a public Testnet, the following steps should be considered:

* <<create-a-new-genesis-block,Create a new unique genesis block>> for the Testnet
** Create new genesis delegates & keep their credentials private and secure.
* <<update-the-configuration-file>>
** Update community identifier here
* <<define-seed-nodes>>
* <<releasing-the-testnet-to-the-public,Release the Testnet to the public>>

.Example file structure
----
.
├── bin/
├── config/
│   └── default/
│       ├── config.json
│       └── genesis_block.json
├── package-lock.json
├── package.json
├── src/
│   ├── app/
│   │   ├── app.ts
│   │   ├── index.ts
│   │   ├── modules/
│   │   ├── modules.ts
│   │   ├── plugins/
│   │   └── plugins.ts
│   └── commands/
└── test/
----

=== Create a new genesis block

The genesis block for the Testnet is created by using the xref:{url_references_cli_genesis}[genesis-block:create] command of the application CLI.

The new genesis block shall have the following properties:

* 23 genesis delegate accounts (default: 103).
* 5 genesis accounts (default: 10).
* 2000 tokens are distributed initially to each genesis account (default: 1000).

NOTE: The above variables for the genesis block can be adjusted as desired.
If no flags are set, the default values will be used.

IMPORTANT: In case a custom value is used for the number of validators, don't forget to <<update-the-configuration-file, update the genesis configuration>> accordingly.

To create the custom genesis block, set the following flags:

[source,bash]
----
./bin/run genesis-block:create --validators 23 --accounts 5 --token-distribution 200000000000
----

For more information about generating a genesis block, check out the guide xref:{url_guides_genesisblock}[].

Replace the old genesis block under `config/default` with the new one.

[CAUTION]
====
The following files should be kept private and not shared with the public:

* `forging_info.json`
* `password.json`
* `accounts.json`
====

=== Update the configuration file

The following config options are most interesting to update:

* `label`: Defines the process name and folder within the root path.
* `version`: Version of the application.
* `networkVersion`: Defines a P2P network version.
* `genesisConfig.bftThreshold`: Defines a threshold for pre-vote and pre-commit of delegates.
* `genesisConfig.communityIdentifier`: Defines a community identifier used to create the network identifier.
* `genesisConfig.blockTime`: Defines the frequency of blocks to be created in seconds.
* `genesisConfig.rewards`: Defines a block reward schedule.
* `genesisConfig.baseFees`:	Defines an additional base fee to be included in the calculation of the minimum fee for a transaction.
* `genesisConfig.activeDelegates`: Number of actively forging delegates.
* `genesisConfig.standbyDelegates`:	Number of random standby delegates that are allowed to forge each round.
* `forging.force`: Force enabling forging by using the default password.
Should be always `false` in the default config.
* `forging.defaultPassword`: Password to automatically decrypt the encrypted passphrase of one or multiple delegates specified in `forging.delegates`.
This is only used for enabling forging for genesis delegates.
Should be removed in the default config.
* `forging.delegates`: Contains the delegate information for forging.
Should be empty in the default config.
* `network.seedPeers`: Defines one or multiple entry node(s) to the network.

[TIP]

====
The sum of `genesisConfig.activeDelegates` and `genesisConfig.standbyDelegates` should be lower or equal to the amount of genesis delegates used to <<create-a-new-genesis-block>>.

The `genesisConfig.bftThreshold` should be around 2/3 of the total forging delegates during each forging round.
====

.config.json
[source,js]
----
{
  "label": "my-app",
  "version": "0.1.0",
  "networkVersion": "1.0",
  "genesisConfig": {
    "bftThreshold": 16,
    "communityIdentifier": "hello",
    "blockTime": 6,
    "maxPayloadLength": 19000,
    "rewards":{
        "milestones": [
            "1000000000",
            "700000000",
            "500000000",
            "200000000",
            "100000000"
        ],
        "offset": 100,
        "distance": 100000
    },
    "minFeePerByte": 500,
    "baseFees": [
        {
            "moduleID": 2,
            "assetID": 0,
            "baseFee": 1000000
        }
    ],
    "activeDelegates": 19,
    "standbyDelegates": 4
  },
  "forging": {
    "force": false,
    "waitThreshold": 2,
    "delegates": [],
  },
  "network": {
    "seedPeers": [
        {
            "ip": "1.2.3.4",
            "port": 5000
        }
    ],
    "port": 5000
  },
  // ...
}
----

=== Define seed nodes

Each node that is connecting to the network for the first time, will initially connect to the seed nodes.
Starting from a seed node, the new node will discover the rest of the network by requesting their peer list.
This is then followed by the peer lists of the newly discovered peers and so on.

To define a node as a seed node, simply add the IP and port of the seed node to the config as described in section <<config,create a configuration object>>.

==== Seed node config

It is convenient to have the genesis delegates actively forging on the seed node, in case the network does not yet have enough real delegates who can take the forging spots.

CAUTION: It is very important to not share the config of the seed nodes with the public, especially if it contains the `defaultPassword` to decrypt the passphrases of the genesis delegates.

Include the data of the new genesis delegates in the config (see xref:{url_guides_genesisblock_enableforging}[Enabling forging for the new genesis delegates]).

=== Releasing the Testnet to the public

Add the code for the customized `node` application (including the custom transactions), to a public code repository.
For example, on  {url_github}[Github^] or {url_gitlab}[Gitlab^].

This provides all users with the opportunity to download the application, and deploy it on a server in order to connect with the network.

The minimum amount of files required for a node application can be seen listed below:

* {url_github_hello_index}[index.js^] :  The code that initializes and starts the node application.
* {url_github_hello_package}[package.json^]: A project file that lists all needed dependencies, (this should include `lisk-sdk` as a dependency).
* {url_github_hello_transaction}[transactions^]: A folder containing all required custom transactions.
* `README` : A Readme file which describes the most important steps to setup the node.

The client application should be distributed in a separate project, and may contain any desired structure as required.

image:guides/launch/testnet-node.png[Two nodes diagram]

As shown in the diagram above, the plan is to connect a second node with public API which has forging disabled.

With this type of setup, the client application communicates through the HTTP API with the new node.
The seed node communicates simultaneously with the new node via WebSockets.
This in turn ensures that the seed node is informed by the API node, each time a new transaction is sent to the network.

TIP: Using this architecture it is convenient to test if the WebSocket connection between the seed node and the new node is established.

[[more_nodes]]
== Become validator for the Testnet

During development of the blockchain application, one node was enabled for forging for all 103 genesis delegates.

After the Testnet-release of the blockchain application, it is necessary that real, independent delegate accounts take the forging slots of the genesis delegates.

NOTE: The network will become decentralized for the first time when at least 52 individual delegates are actively forging in the network.

.Forging nodes join the network
image:guides/launch/testnet-delegate-nodes.png[3 nodes diagram]

To join the network as a new delegate, follow the steps listed below:

. Create an own, private account on the network.
.. xref:{url_references_cli_createaccount}[Generate the account credentials]
.. Send some funds, (which must be an adequate amount in order to register as a delegate) to the newly generated address.
. xref:{url_guides_forging_register}[Register a delegate].
. Set up a <<node_app,node>>: Follow the steps in the `README` file or docs of the app.
Normally it involves downloading the application code from a public source, connfiguring it (via config or flags on startup), and starting the application.
. xref:{url_guides_forging}[Enable forging] for the newly registered delegate.
. Perform self-vote
. Optional: Convince other accounts to vote for the delegate, to increase the delegate vote weight.

.How to replace a genesis delegate
[NOTE]
====
If a delegate joins the network at a very early stage, it is likely they will probably replace one of the genesis delegates.
The genesis delegates are voted in by the genesis account which holds all the tokens on the initial network start.
The genesis account votes with these tokens for the genesis delegates, in order to stabilize the network during the development.

Therefore, when replacing a genesis delegate, the new delegate will need to convince the person who controls the genesis account of the network; which will most likely be the app developer.
Later, when the majority of the existing tokens are distributed amongst the different private accounts, the new delegate needs to gain the trust of the community in order to be voted into a forging position.
====
