= Configuration with Docker
Mona Bärenfänger <mona@lightcurve.io>
:description: Describes how to configure Lisk Service with Docker.
:toc:
:imagesdir: ../assets/images
:page-previous: /lisk-service/setup/docker.html
:page-previous-title: Installation with Docker
:page-next: /lisk-service/management/docker.html
:page-next-title: Docker commands

:url_references_config: references/configuration.adoc

How to configure Lisk Service.

== Configuring Lisk Service

Copy the example configuration options to `lisk-service/.env`:

.lisk-service/
[source,bash]
----
cp docker/example.env .env
vim .env
----

Open the `.env` file to change thee default configuration options of Lisk Service:

.lisk-service/.env
[source,bash]
----
## Common Docker configuration

# Service broker
# SERVICE_BROKER=redis://redis_common:6379/0

# Lisk Service log config
# SERVICE_LOG_CONSOLE=false
# SERVICE_LOG_FILE=false
# SERVICE_LOG_GELF=false
# SERVICE_LOG_LEVEL=debug
# SERVICE_LOG_STDOUT=true

## Lisk Service Core
# SERVICE_CORE_REDIS=redis://redis_core_persistent:6379/0
# SERVICE_CORE_REDIS_VOLATILE=redis://redis_core_volatile:6379/0
# SERVICE_CORE_MYSQL=mysql://lisk:password@mysql_core:3306/lisk

# Lisk static assets, ie. known account lists
LISK_STATIC=https://static-data.lisk.com

# Lisk Service geolocation backend (empty = disabled)
GEOIP_JSON=

# Create search index (0 = full index)
INDEX_N_BLOCKS=0

# Use default genesis block height
# GENESIS_HEIGHT=0
# FEE_EST_DEFAULT_START_BLOCK_HEIGHT=0

# Fee estimator
ENABLE_FEE_ESTIMATOR_QUICK=true
ENABLE_FEE_ESTIMATOR_FULL=false

# Transaction statistics
ENABLE_TRANSACTION_STATS=true

# Missing blocks job
ENABLE_JOB_MISSING_BLOCKS=true
INDEX_MISSING_BLOCKS_RANGE=0

# Log debug messages
#DEBUG=*dynamicFees*

# Lisk ecosystem configuration
LISK_CORE_WS=ws://host.docker.internal:8080

# Websocket rate limit config
WS_RATE_LIMIT_ENABLE=false
WS_RATE_LIMIT_CONNECTIONS=5
WS_RATE_LIMIT_DURATION=1 # in seconds

# HTTP rate limit config
HTTP_RATE_LIMIT_ENABLE=false
HTTP_RATE_LIMIT_CONNECTIONS=200
HTTP_RATE_LIMIT_WINDOW=10 # in seconds

## Lisk Service Gateway
# PORT=9901
# HOST=0.0.0.0

# Enabled Gateway APIs
ENABLE_HTTP_API=http-status,http-version2
ENABLE_WS_API=blockchain,rpc-v2

# HTTP API caching config
ENABLE_HTTP_CACHE_CONTROL=false
HTTP_CACHE_CONTROL_DIRECTIVES=public,max-age=10

# SERVICE_GATEWAY_REDIS_VOLATILE=redis://redis_gateway_volatile:6379/1

# Websocket rate limit config
ENABLE_WS_RATELIMIT=false
WS_RATELIMIT_POINTS=5
WS_RATELIMIT_DURATION=1 # in seconds

## Lisk Service Market
# SERVICE_MARKET_REDIS=redis://redis_market:6379/0

# MySQL install
MYSQL_ROOT_PASSWORD=password
MYSQL_DATABASE=lisk
MYSQL_USER=lisk
MYSQL_PASSWORD=password

## Lisk Service Newsfeed
SERVICE_NEWSFEED_MYSQL=mysql://lisk:password@mysql_newsfeed:3306/lisk
----

== Show current configuration

To show the current configuration of Lisk Service, execute the following command:

.lisk-service/
[source,bash]
----
make print-config
----

.Result for the default config, which will connect Lisk Service to the Lisk Mainnet
[source,yaml]
----
networks:
  core_network: {}
  services_network: {}
services:
  core:
    depends_on:
      mysql_core:
        condition: service_started
      redis_common:
        condition: service_started
      redis_core:
        condition: service_started
    environment:
      ENABLE_FEE_ESTIMATOR_FULL: "false"
      ENABLE_FEE_ESTIMATOR_QUICK: "true"
      ENABLE_JOB_MISSING_BLOCKS: "true"
      ENABLE_TRANSACTION_STATS: "true"
      FEE_EST_DEFAULT_START_BLOCK_HEIGHT: ''
      GENESIS_BLOCK_URL: ''
      GENESIS_HEIGHT: ''
      GEOIP_JSON: https://geoip.lisk.com/json
      INDEX_MISSING_BLOCKS_RANGE: '1080'
      INDEX_N_BLOCKS: '0'
      LISK_CORE_HTTP: ''
      LISK_CORE_WS: ''
      LISK_STATIC: https://static-data.lisk.com
      SERVICE_BROKER: redis://redis_common:6379/0
      SERVICE_CORE_MYSQL: mysql://lisk:password@mysql_core:3306/lisk
      SERVICE_CORE_REDIS: redis://redis_core:6379/0
      SERVICE_LOG_CONSOLE: "false"
      SERVICE_LOG_FILE: "false"
      SERVICE_LOG_GELF: "false"
      SERVICE_LOG_LEVEL: debug
      SERVICE_LOG_STDOUT: "true"
      TRANSACTION_STATS_HISTORY_LENGTH_DAYS: ''
    extra_hosts:
      host.docker.internal: host-gateway
    image: lisk/service_core
    networks:
      core_network: {}
      services_network: {}
    restart: always
  gateway:
    depends_on:
      core:
        condition: service_started
    environment:
      ENABLE_HTTP_API: ''
      ENABLE_HTTP_CACHE_CONTROL: "false"
      ENABLE_WS_API: ''
      HOST: 0.0.0.0
      HTTP_CACHE_CONTROL_DIRECTIVES: public,max-age=10
      PORT: '9901'
      SERVICE_BROKER: redis://redis_common:6379/0
      SERVICE_LOG_CONSOLE: "false"
      SERVICE_LOG_FILE: "false"
      SERVICE_LOG_GELF: "false"
      SERVICE_LOG_LEVEL: debug
      SERVICE_LOG_STDOUT: "true"
    healthcheck:
      test: curl --fail http://gateway:9901/api/v1/transactions
    image: lisk/service_gateway
    networks:
      services_network: {}
    ports:
    - 127.0.0.1:9901:9901/tcp
    restart: always
  market:
    depends_on:
      redis_common:
        condition: service_started
      redis_market:
        condition: service_started
    environment:
      SERVICE_BROKER: redis://redis_common:6379/0
      SERVICE_LOG_CONSOLE: "false"
      SERVICE_LOG_FILE: "false"
      SERVICE_LOG_GELF: "false"
      SERVICE_LOG_LEVEL: debug
      SERVICE_LOG_STDOUT: "true"
      SERVICE_MARKET_REDIS: redis://redis_market:6379/0
    image: lisk/service_market
    networks:
      services_network: {}
    restart: always
  mysql_core:
    environment:
      MYSQL_DATABASE: lisk
      MYSQL_PASSWORD: password
      MYSQL_ROOT_PASSWORD: password
      MYSQL_USER: lisk
    healthcheck:
      retries: 10
      test:
      - CMD
      - mysqladmin
      - ping
      - -h
      - localhost
      timeout: 20s
    image: mysql:5.7
    networks:
      core_network: {}
    restart: always
    volumes:
    - mysql-data:/var/lib/mysql:rw
  redis_common:
    command: redis-server /etc/redis/redis.conf
    healthcheck:
      test: redis-cli ping
    image: redis:5-alpine
    networks:
      services_network: {}
    restart: always
    volumes:
    - /home/michal/lisk-service/docker/redis/redis.volatile.conf:/etc/redis/redis.conf:ro
  redis_core:
    command: redis-server /etc/redis/redis.conf
    healthcheck:
      test: redis-cli ping
    image: redis:5-alpine
    networks:
      core_network: {}
    restart: always
    volumes:
    - /home/michal/lisk-service/docker/redis/redis.persistent.conf:/etc/redis/redis.conf:ro
  redis_market:
    command: redis-server /etc/redis/redis.conf
    healthcheck:
      test: redis-cli ping
    image: redis:5-alpine
    networks:
      services_network: {}
    restart: always
    volumes:
    - /home/michal/lisk-service/docker/redis/redis.persistent.conf:/etc/redis/redis.conf:ro
version: '3'
volumes:
  mysql-data: {}
----

