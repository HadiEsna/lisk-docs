= Cross-chain communication
:toc: preamble

On this page, we dive deeper into the details how cross-chain communication works in the Lisk ecosystem, by describing the different components and the general processes, how state changes are executed across chains in the Lisk ecosystem.

== Inducing state changes across chains with CCMs

Cross-chain messages, or CCMs, are the central component of the cross-chain communication between different sidechains.

Similar to a normal transaction, a CCM includes a reference to a command that triggers state mutations.
But in case of a CCM, the command always refers to a cross-chain command, and the state changes are not only executed in the sending chain, but also in the receiving chain.

[NOTE]
====
A *Cross-chain message (CCM)* is the envelope for a cross-chain command.

*Cross-chain commands*, or *CC-commands*, induce a state transition in the receiving chain.
====

A CCM includes the following properties:

.Structure of a CCM
image:understand-blockchain/interop/ccm.png[]

sending-chain ID:: description
receiving-chain ID:: description
module name:: description
CCC name:: description
nonce:: description
fee:: description
parameters:: description
status:: description

:sectnums:
== Using CCTs to generate CCMs

Let's look at a example of a simple cross-chain transfer between Alice and Bob.

Alice has 10 LSK in her account on a chain, in this context, we call it the sending chain.
She wants to transfer 5 LSK to Bob, who has an account on another chain, in this context the receiving chain.

Here is where *cross-chain transactions (CCTs)* come into play.

NOTE: A cross-chain transaction (CCT) is a transaction that, upon its execution, creates one or more cross-chain messages.

image:understand-blockchain/interop/ccc-1.png[,300,role="right"]

In fact, a cross-chain transaction uses the identical schema as normal transactions.
The only difference is, that a CCT refers to a **cross-chain command**, instead of a normal command.

This cross-chain command will

* execute the necessary changes on the sending chain (i.e. removing 5 LSK from Alices balance), and
* also create CCMs to trigger the corresponding state changes in the receiving chain (i.e. add 5 LSK to Bobs balance).


== Transferring CCMs in a CCU

Several cross-chain messages are collected together and posted to another chain as part of a cross-chain update


image::understand-blockchain/ccu.png[]

=== Sidechain to mainchain
image:understand-blockchain/interop/ccc-2.png[,300,role=""]

=== Mainchain to sidechain
image:understand-blockchain/interop/ccc-3.png[,300,role=""]

== Executing the CCC on the receiving chain

*Cross-chain commands*, or *CC-commands*, induce a state transition in the receiving chain, if:

* the receiving chain exists, and has the status `active`.
* the receiving application understands the particular command, i.e. if it includes the required module to interpret the command name
* the CCM includes all parameters required for the CC-command

:!sectnums:

== Complete cross-chain-communicatin flow

image::understand-blockchain/interop/cc-cmmunication-flow.png[,300]

== Error handling

=== CCM validation in the Mainchain
image:understand-blockchain/interop/ccc-2b.png[,300,role=""]

=== CCM validation in the receiving chain
image:understand-blockchain/interop/ccc-3b.png[,300,role=""]

